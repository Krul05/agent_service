services:
  agent-service:
    build: .
    ports:
      - "8080:8080"
    environment:
      HOST: ${HOST:-0.0.0.0}
      PORT: ${PORT:-8080}

      GITHUB_APP_ID: ${GITHUB_APP_ID}
      GITHUB_APP_PRIVATE_KEY_PATH: ${GITHUB_APP_PRIVATE_KEY_PATH}
      GITHUB_WEBHOOK_SECRET: ${GITHUB_WEBHOOK_SECRET}

      API_KEY: ${API_KEY}
      MODEL: ${MODEL:-gpt://ajectldinp5kbvbuii6r/yandexgpt-lite}
      LLM_BASE_URL: ${LLM_BASE_URL:-https://llm.api.cloud.yandex.net}

      BASE_BRANCH: ${BASE_BRANCH:-master}
      MAX_ITERS: ${MAX_ITERS:-5}
      WORKDIR: ${WORKDIR:-/tmp/agent-workdir}

    volumes:
      - agent-workdir:${WORKDIR:-/tmp/agent-workdir}
      - ./secrets:/run/secrets:ro

    command: ["uvicorn", "app.main:app", "--host", "0.0.0.0", "--port", "8080"]

volumes:
  agent-workdir:
